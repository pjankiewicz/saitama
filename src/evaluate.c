
#include "defs.h"
#include "mlp.h"

// clang-format off


const int WhitePieceSquareEvals[7][64] = {
        {}, // to match the empty piece
        {
                0, 0,   0,   0,  0,  0,   0,   0,
                10, 10, 0, -10, -10, 0, 10, 10,
                5, 0, 0,  5,  5,  0,  0, 5,
                0, 0,  10, 20, 20, 10, 0,  0,
                5, 5,  5,  10, 10, 5,  5,  5,
                10, 10, 10, 20, 20, 10, 10, 10,
                20, 20, 20, 30, 30, 20, 20, 20,
                0, 0, 0, 0,  0,  0, 0, 0
        },
        {
                0, -20, 0,   0,  0,  0,   -20, 0,
                0,  0,  0, 5,   5,   0, 0,  0,
                0, 0, 10, 10, 10, 10, 0, 0,
                0, 0,  10, 20, 20, 10, 5,  0,
                5, 10, 15, 20, 20, 15, 10, 5,
                5,  10, 10, 20, 20, 10, 10, 5,
                0,  0,  5,  10, 10, 5,  0,  0,
                0, 0, 0, 0,  0,  0, 0, 0
        },
        {
                0, 0,   -20, 0,  0,  -20, 0,   0,
                0,  0,  0, 10,  10,  0, 0,  0,
                0, 0, 10, 15, 15, 10, 0, 0,
                0, 10, 15, 20, 20, 15, 10, 0,
                0, 10, 15, 20, 20, 15, 10, 0,
                0,  0,  10, 15, 15, 10, 0,  0,
                0,  0,  0,  10, 10, 0,  0,  0,
                0, 0, 0, 0,  0,  0, 0, 0
        },
        {
                0, 0,   5,   10, 10, 5,   0,   0,
                0,  0,  5, 10,  10,  5, 0,  0,
                0, 0, 5,  10, 10, 5,  0, 0,
                0, 0,  5,  10, 10, 5,  0,  0,
                0, 0,  5,  10, 10, 5,  0,  0,
                0,  0,  5,  10, 10, 5,  0,  0,
                25, 25, 25, 25, 25, 25, 25, 25,
                0, 0, 5, 10, 10, 5, 0, 0
        },
        {
                0, 0,   0,   0,  0,  0,   0,   0,
                0,  0,  0, 10,  10,  0, 0,  0,
                0, 0, 10, 15, 15, 10, 0, 0,
                0, 10, 15, 20, 20, 15, 10, 0,
                0, 10, 15, 20, 20, 15, 10, 0,
                0,  0,  10, 15, 15, 10, 0,  0,
                0,  0,  0,  10, 10, 0,  0,  0,
                0, 0, 0, 0,  0,  0, 0, 0
        },
        {
                0, 0,   0,   0,  0,  0,   0,   0,
                0,  0,  0, 0,   0,   0, 0,  0,
                0, 0, 0,  0,  0,  0,  0, 0,
                0, 0,  0,  0,  0,  0,  0,  0,
                0, 0,  0,  0,  0,  0,  0,  0,
                0,  0,  0,  0,  0,  0,  0,  0,
                0,  0,  0,  0,  0,  0,  0,  0,
                0, 0, 0, 0,  0,  0, 0, 0
        }
};


const int PieceSquareEvals[13][64] = {
        {},
        {0,    0,    0,    0,    0,    0,    0,    0,    109,  110,  90,   79,   92,   118,  136,  115,  107,  106,  96,   86,   101,  101,  130,  114,  109,  113,  94,   103,  102,  101,  119,  97,   143,  135,  113,  109,  113,  127,  146,  136,  211,  211,  190,  168,  180,  193,  220,  201,  297,  275,  270,  237,  245,  244,  274,  262,  0,    0,    0,    0,    0,    0,    0,    0},
        {254,  295,  280,  292,  287,  313,  293,  284,  303,  293,  307,  319,  320,  327,  303,  322,  307,  314,  331,  332,  330,  329,  331,  294,  311,  324,  342,  342,  353,  343,  335,  305,  330,  340,  333,  367,  345,  359,  334,  321,  300,  322,  356,  359,  340,  365,  346,  303,  279,  307,  349,  321,  336,  337,  292,  301,  206,  255,  265,  281,  295,  240,  237,  215},
        {326,  320,  346,  324,  322,  326,  282,  312,  309,  364,  342,  349,  348,  357,  364,  349,  358,  346,  355,  355,  359,  351,  354,  344,  327,  347,  353,  355,  361,  360,  346,  325,  339,  350,  358,  363,  358,  344,  355,  333,  343,  340,  370,  359,  343,  362,  356,  374,  327,  350,  342,  310,  348,  345,  345,  344,  309,  282,  292,  308,  296,  308,  246,  283},
        {500,  513,  522,  525,  522,  514,  495,  487,  500,  516,  519,  515,  515,  521,  527,  489,  509,  516,  519,  516,  515,  518,  526,  510,  514,  523,  521,  524,  516,  524,  520,  510,  538,  524,  529,  531,  532,  533,  532,  545,  527,  529,  533,  539,  534,  540,  540,  534,  545,  550,  545,  545,  537,  540,  533,  536,  555,  535,  545,  541,  547,  521,  517,  531},
        {972,  944,  939,  954,  942,  936,  902,  899,  941,  958,  955,  956,  960,  955,  952,  944,  942,  951,  958,  950,  958,  967,  976,  948,  944,  958,  950,  960,  971,  959,  971,  960,  937,  947,  946,  958,  974,  981,  971,  992,  929,  946,  970,  976,  1011, 1005, 1015, 997,  937,  944,  946,  934,  964,  1015, 1000, 1018, 926,  954,  938,  971,  951,  962,  920,  951},
        {-27,  4,    0,    -49,  -21,  -37,  -9,   -22,  -31,  0,    -3,   -10,  -15,  -4,   -4,   -13,  -34,  0,    -2,   2,    0,    -5,   -1,   -17,  -13,  6,    11,   4,    5,    6,    2,    -18,  0,    16,   22,   4,    2,    12,   17,   6,    0,    37,   23,   3,    9,    18,   39,   21,   0,    22,   15,   -12,  -13,  8,    22,   6,    -81,  1,    -20,  -18,  -20,  -19,  -10,  -34},
        {0,    0,    0,    0,    0,    0,    0,    0,    -208, -199, -179, -168, -188, -190, -188, -193, -133, -137, -128, -115, -116, -124, -130, -127, -86,  -87,  -79,  -88,  -93,  -84,  -83,  -85,  -67,  -84,  -81,  -96,  -93,  -81,  -82,  -59,  -70,  -84,  -85,  -87,  -96,  -77,  -100, -75,  -71,  -94,  -79,  -75,  -87,  -108, -114, -78,  0,    0,    0,    0,    0,    0,    0,    0},
        {-162, -201, -254, -269, -269, -233, -230, -191, -232, -272, -318, -312, -314, -307, -275, -247, -279, -300, -317, -343, -339, -344, -310, -277, -297, -320, -322, -352, -338, -338, -312, -305, -296, -305, -334, -330, -336, -329, -298, -297, -284, -310, -330, -333, -338, -335, -325, -289, -287, -268, -300, -322, -323, -326, -303, -303, -236, -292, -278, -300, -292, -305, -290, -255},
        {-300, -295, -332, -314, -311, -319, -332, -319, -298, -337, -325, -342, -350, -342, -331, -308, -319, -344, -358, -353, -360, -365, -348, -336, -328, -343, -360, -372, -370, -350, -350, -329, -330, -344, -365, -360, -370, -358, -347, -318, -335, -361, -365, -364, -365, -369, -351, -347, -340, -359, -354, -350, -359, -354, -380, -338, -332, -334, -335, -345, -333, -329, -338, -327},
        {-546, -549, -547, -546, -548, -534, -547, -525, -525, -528, -543, -540, -529, -540, -532, -523, -533, -537, -525, -532, -537, -528, -513, -511, -519, -528, -537, -534, -524, -527, -523, -517, -511, -519, -520, -529, -520, -512, -510, -496, -499, -513, -514, -520, -521, -510, -497, -496, -488, -510, -515, -519, -511, -511, -517, -473, -505, -512, -524, -531, -527, -521, -483, -483},
        {-894, -927, -956, -956, -965, -949, -915, -920, -888, -883, -924, -948, -929, -993, -935, -945, -890, -913, -935, -960, -981, -970, -966, -962, -896, -922, -921, -933, -952, -967, -927, -942, -922, -928, -934, -945, -944, -944, -946, -925, -909, -934, -935, -945, -943, -950, -938, -921, -919, -938, -942, -948, -951, -948, -938, -934, -939, -924, -928, -946, -937, -921, -882, -904},
        {44,   18,   -17,  2,    -13,  -21,  -14,  -23,  21,   -1,   -11,  -33,  -38,  -72,  -35,  -10,  26,   -13,  -9,   -24,  -27,  -49,  -34,  -19,  48,   14,   -9,   -16,  -22,  -30,  -27,  4,    44,   3,    0,    -18,  -23,  -22,  -12,  15,   27,   11,   -3,   -9,   -15,  -19,  -9,   11,   22,   14,   3,    14,   3,    -5,   -9,   8,    23,   6,    19,   36,   5,    29,   0,    26},
};


const int PieceSquarePhaseEvals[3][12][64] = {{{0, 0, 0, 0, 0, 0, 0, 0, 61,  88,  74,  66,  78,  94,  116, 70,  56,  74,  80,  70,  86,  69,  106, 69,  51,  77,  72,  91,  90,  77,  82,  30,  74,  89,  84,  90,  106, 86,  100, 52,  65,  89,  108, 101, 116, 155, 101, 80,  57,  109, 122, 115, 124, 150, 134, 82,  0, 0, 0, 0, 0, 0, 0, 0}, {275, 309, 284, 298, 284, 302, 307, 233, 306, 328, 323, 328, 329, 331, 329, 322, 315, 321, 343, 336, 343, 337, 340, 293, 321, 328, 342, 342, 355, 348, 332, 302, 363, 350, 329, 376, 350, 356, 332, 306, 308, 354, 358, 385, 380, 391, 371, 277, 225, 311, 393, 302, 367, 361, 272, 321, 190, 52,  245, 308, 155, 188, 167, 203}, {340, 345, 363, 331, 323, 345, 235, 338, 343, 389, 367, 364, 365, 381, 386, 384, 389, 367, 380, 371, 372, 370, 372, 369, 349, 364, 364, 387, 380, 375, 365, 335, 348, 359, 381, 382, 383, 369, 361, 351, 360, 383, 401, 380, 374, 411, 367, 390, 319, 374, 379, 351, 373, 355, 331, 343, 421, 215, 109, 381, 194, 362, 214, 299}, {406, 410, 417, 421, 422, 417, 402, 423, 386, 393, 377, 378, 411, 411, 384, 368, 381, 404, 428, 358, 364, 399, 330, 414, 388, 389, 343, 367, 394, 378, 386, 369, 420, 373, 395, 380, 400, 434, 453, 458, 378, 476, 404, 453, 386, 301, 410, 374, 492, 410, 417, 300, 347, 157, 417, 361, 447, 182, 324, 299, 214, 50, 175, 393}, {748, 729, 732, 745, 726, 698, 519, 621, 715, 740, 744, 750, 749, 727, 750, 714, 729, 743, 720, 740, 739, 755, 751, 711, 724, 743, 721, 733, 753, 726, 749, 715, 723, 722, 724, 735, 756, 712, 722, 759, 703, 698, 741, 781, 758, 675, 788, 779, 696, 717, 727, 609, 657, 784, 693, 751, 698, 525, 678, 549, 380, 356, 471, 708}, {17, 62, 43, -6, 25, 5, 63, 55, -24, 47, 22, -25, -23, 26, 47, 48, 40, 83, 3, -49, -13, -37, 34, 9, -1, 0, -13, -60, 1, -61, -316, 4, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}, {0, 0, 0, 0, 0, 0, 0, 0, -77, -102, -51, -88, -130, -156, -177, -83, -59, -65, -83, -78, -104, -116, -68, -84, -69, -81, -71, -92, -99, -87, -87, -67, -54, -89, -76, -102, -98, -93, -95, -51, -61, -79, -85, -83, -99, -78, -119, -81, -60, -95, -74, -72, -90, -120, -141, -88, 0, 0, 0, 0, 0, 0, 0, 0}, {-146, -128, -158, -274, -167, -169, -144, -172, -268, -275, -340, -319, -289, -330, -253, -289, -262, -310, -290, -351, -386, -360, -316, -307, -319, -338, -317, -369, -339, -341, -318, -327, -307, -319, -334, -338, -341, -332, -302, -300, -297, -319, -344, -339, -340, -337, -339, -297, -322, -285, -311, -329, -329, -351, -314, -319, -216, -307, -282, -302, -297, -298, -302, -230}, {-332, -256, -219, -281, -59, -272, -173, -275, -284, -363, -328, -343, -332, -342, -321, -329, -333, -344, -368, -351, -365, -330, -354, -380, -330, -355, -377, -366, -379, -329, -364, -333, -330, -364, -370, -392, -383, -367, -354, -316, -352, -359, -385, -367, -379, -381, -356, -373, -326, -384, -357, -362, -365, -388, -397, -356, -373, -318, -353, -335, -348, -339, -352, -354}, {-384, -146, -220, -315, -223, 0, -44, -274, -368, -394, -347, -332, -338, -135, -416, -375, -456, -354, -353, -364, -384, -370, -249, -406, -386, -405, -414, -426, -381, -326, -365, -454, -406, -351, -378, -437, -423, -423, -350, -408, -392, -414, -404, -390, -421, -427, -433, -417, -388, -392, -415, -424, -404, -422, -426, -386, -417, -414, -432, -430, -435, -426, -410, -425}, {-661, -565, -567, -406, -331, -170, -394, -562, -670, -664, -651, -596, -579, -711, -704, -682, -680, -667, -731, -733, -739, -591, -698, -729, -680, -694, -691, -721, -698, -698, -657, -707, -700, -691, -712, -717, -714, -717, -712, -707, -679, -722, -709, -716, -709, -719, -708, -699, -694, -720, -723, -723, -728, -718, -742, -692, -697, -704, -709, -729, -706, -666, -670, -688}, {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 35, -5, 32, 69, 36, 0, -14, -9, 36, 1, 28, 56, 103, 37, -4, 41, -73, -31, -20, 39, 12, -12, -73, -51, 11, -40, -37, -4, -37, 1, -74, -49}},
                                              {{0, 0, 0, 0, 0, 0, 0, 0, 69,  78,  73,  66,  79,  88,  97,  71,  66,  72,  69,  69,  79,  67,  91,  73,  66,  73,  70,  73,  73,  64,  67,  52,  87,  88,  85,  78,  79,  75,  86,  70,  115, 121, 129, 110, 115, 136, 121, 106, 184, 205, 167, 174, 146, 131, 154, 147, 0, 0, 0, 0, 0, 0, 0, 0}, {232, 253, 256, 266, 266, 276, 237, 231, 265, 252, 264, 281, 288, 297, 265, 281, 276, 285, 296, 306, 302, 297, 288, 265, 282, 295, 308, 309, 320, 311, 292, 280, 306, 304, 316, 346, 317, 336, 316, 307, 287, 307, 329, 340, 329, 366, 337, 286, 265, 288, 309, 322, 320, 329, 293, 250, 221, 278, 266, 258, 275, 234, 192, 222}, {287, 290, 301, 284, 292, 288, 266, 274, 272, 320, 306, 316, 317, 322, 325, 296, 328, 325, 325, 322, 329, 322, 310, 310, 313, 317, 327, 325, 334, 326, 311, 302, 312, 327, 329, 332, 329, 328, 325, 307, 310, 305, 347, 336, 341, 358, 362, 334, 307, 322, 317, 309, 328, 348, 333, 328, 299, 305, 294, 308, 291, 279, 288, 295}, {437, 445, 454, 457, 454, 449, 432, 419, 429, 446, 448, 444, 447, 453, 449, 416, 432, 432, 446, 458, 451, 444, 438, 445, 429, 442, 453, 456, 445, 437, 447, 425, 450, 441, 468, 460, 466, 468, 458, 466, 457, 475, 484, 480, 475, 477, 462, 469, 475, 480, 488, 490, 479, 490, 495, 471, 473, 467, 498, 499, 503, 461, 429, 473}, {817, 797, 796, 808, 799, 789, 730, 749, 797, 815, 814, 814, 822, 811, 810, 801, 801, 812, 828, 817, 820, 827, 830, 826, 807, 815, 816, 827, 827, 825, 835, 823, 799, 806, 807, 821, 830, 846, 842, 850, 797, 801, 838, 836, 861, 873, 881, 859, 807, 813, 818, 802, 829, 896, 911, 899, 784, 801, 797, 814, 844, 874, 751, 809}, {-33, 9, 9, -50, -26, -32, -5, -14, 2, 2, 7, -5, -7, -2, 4, -8, -32, 24, 1, 6, 8, -7, 1, -18, 14, 9, 41, 11, 18, 17, 14, -51, -64, 34, 40, 69, 12, -18, 13, 15, 31, 51, -2, 101, 31, -45, -5, 92, -41, -54, -17, -85, 0, -29, -30, -43, 0, 0, 0, -18, 0, 0, -22, 0}, {0, 0, 0, 0, 0, 0, 0, 0, -147, -166, -125, -138, -158, -118, -76, -103, -91, -94, -108, -96, -93, -117, -102, -72, -74, -81, -71, -72, -77, -78, -81, -73, -56, -75, -70, -78, -79, -72, -77, -62, -58, -71, -72, -75, -86, -75, -95, -73, -62, -79, -75, -66, -77, -98, -105, -71, 0, 0, 0, 0, 0, 0, 0, 0}, {-192, -158, -232, -261, -248, -222, -149, -229, -224, -252, -297, -303, -312, -311, -257, -234, -264, -271, -309, -316, -320, -333, -321, -270, -277, -302, -301, -329, -311, -314, -293, -287, -272, -265, -307, -305, -314, -302, -285, -266, -263, -271, -287, -297, -309, -298, -281, -255, -232, -247, -264, -283, -285, -283, -264, -275, -212, -245, -241, -267, -257, -277, -243, -225}, {-260, -237, -303, -288, -241, -274, -205, -280, -287, -314, -290, -282, -309, -333, -309, -301, -311, -320, -340, -306, -327, -342, -313, -316, -305, -316, -328, -347, -333, -319, -320, -302, -287, -309, -328, -329, -341, -325, -315, -294, -308, -332, -323, -326, -330, -329, -309, -311, -284, -311, -313, -311, -319, -313, -329, -286, -303, -276, -288, -304, -292, -286, -284, -291}, {-464, -470, -478, -491, -463, -480, -399, -434, -450, -464, -485, -474, -463, -466, -500, -470, -469, -449, -457, -469, -466, -468, -461, -453, -445, -457, -467, -474, -456, -468, -457, -450, -445, -436, -439, -448, -454, -441, -429, -425, -411, -422, -439, -452, -453, -442, -449, -426, -402, -441, -435, -441, -441, -442, -456, -420, -436, -443, -451, -458, -453, -450, -429, -414}, {-750, -764, -814, -785, -818, -791, -708, -761, -777, -769, -780, -802, -771, -843, -814, -858, -772, -772, -796, -791, -846, -833, -852, -843, -757, -798, -782, -794, -813, -804, -801, -814, -782, -796, -793, -813, -806, -809, -816, -778, -760, -779, -799, -812, -808, -807, -797, -791, -766, -793, -798, -802, -806, -802, -793, -775, -781, -777, -775, -791, -794, -770, -735, -766}, {53, -8, 76, -44, 203, 0, -8, -22, 34, -84, 0, 13, -10, -50, -37, 39, -33, -62, -17, -139, 45, -80, -60, 61, 22, 7, -17, 27, -34, 9, 9, -7, 47, 1, -13, -5, -1, -23, -6, 36, -2, -2, -5, -7, -16, -22, -19, 6, -21, 11, -7, 8, -3, -7, -15, -5, 30, -7, 10, 37, 11, 29, -9, 4}},
                                              {{0, 0, 0, 0, 0, 0, 0, 0, 133, 134, 124, 105, 129, 130, 139, 122, 123, 126, 119, 116, 118, 118, 132, 117, 133, 138, 122, 118, 115, 119, 130, 119, 170, 166, 149, 138, 131, 145, 156, 147, 241, 247, 224, 212, 209, 204, 235, 226, 305, 308, 300, 263, 267, 262, 300, 275, 0, 0, 0, 0, 0, 0, 0, 0}, {179, 192, 211, 235, 212, 246, 234, 185, 223, 225, 228, 260, 238, 244, 242, 218, 219, 236, 259, 262, 258, 264, 255, 214, 228, 260, 264, 281, 282, 271, 265, 258, 243, 263, 262, 270, 272, 294, 264, 254, 221, 232, 268, 266, 249, 279, 251, 234, 195, 217, 246, 241, 244, 225, 227, 229, 157, 200, 214, 231, 239, 210, 203, 185}, {228, 241, 264, 257, 247, 262, 225, 243, 241, 277, 261, 270, 272, 282, 263, 237, 237, 264, 275, 273, 276, 267, 270, 234, 254, 262, 278, 290, 272, 282, 269, 265, 272, 269, 273, 280, 275, 268, 281, 264, 261, 267, 271, 276, 254, 281, 263, 280, 236, 261, 249, 231, 259, 248, 254, 229, 212, 229, 234, 235, 240, 251, 205, 200}, {482, 481, 491, 488, 492, 486, 481, 469, 468, 466, 482, 484, 474, 478, 469, 463, 472, 472, 475, 454, 469, 479, 481, 471, 471, 472, 481, 479, 479, 480, 474, 465, 490, 477, 471, 488, 484, 488, 491, 488, 477, 479, 476, 475, 481, 488, 497, 484, 485, 489, 485, 484, 483, 480, 485, 481, 502, 492, 495, 491, 489, 483, 475, 480}, {802, 810, 801, 804, 840, 817, 790, 774, 855, 848, 811, 827, 838, 790, 833, 759, 796, 834, 846, 831, 828, 820, 844, 800, 825, 837, 837, 850, 870, 851, 831, 841, 787, 834, 824, 840, 848, 877, 835, 847, 807, 832, 855, 851, 878, 869, 863, 849, 813, 813, 806, 816, 848, 892, 869, 847, 846, 860, 848, 872, 858, 870, 842, 874}, {-21, -25, -29, -37, -35, -39, -33, -45, -30, -7, -12, -11, -17, -14, -11, -22, -36, -9, -6, -1, -5, -9, -4, -20, -25, 1, 6, 4, 3, 12, 2, -13, -8, 16, 24, 5, 8, 17, 26, 7, -2, 39, 24, 7, 10, 27, 45, 21, 4, 20, 22, 2, 2, 15, 28, 15, -83, -2, -2, -7, 2, 3, 1, -19}, {0, 0, 0, 0, 0, 0, 0, 0, -203, -206, -198, -167, -181, -183, -188, -183, -150, -148, -138, -123, -121, -107, -119, -137, -97, -90, -86, -78, -78, -74, -84, -89, -81, -78, -73, -71, -67, -69, -78, -74, -82, -85, -79, -78, -78, -78, -82, -77, -87, -97, -89, -87, -75, -99, -100, -76, 0, 0, 0, 0, 0, 0, 0, 0}, {-159, -201, -235, -224, -234, -225, -205, -111, -191, -228, -247, -257, -242, -230, -228, -216, -222, -251, -259, -272, -276, -263, -233, -214, -242, -253, -272, -277, -280, -273, -255, -230, -222, -258, -275, -286, -300, -277, -248, -244, -225, -261, -263, -293, -283, -262, -262, -218, -221, -244, -248, -261, -276, -270, -254, -234, -176, -219, -220, -244, -247, -245, -246, -204}, {-283, -282, -300, -288, -293, -289, -278, -290, -274, -305, -299, -307, -302, -293, -298, -267, -300, -297, -305, -320, -315, -309, -288, -267, -281, -298, -299, -319, -323, -305, -292, -271, -302, -287, -315, -308, -304, -309, -283, -275, -268, -301, -309, -322, -311, -307, -294, -273, -295, -301, -293, -284, -291, -299, -291, -274, -280, -297, -291, -296, -281, -292, -281, -283}, {-509, -516, -514, -501, -501, -494, -500, -484, -489, -503, -504, -495, -490, -498, -494, -486, -494, -502, -495, -481, -495, -484, -477, -476, -494, -495, -499, -493, -487, -488, -489, -484, -472, -492, -493, -495, -484, -479, -477, -470, -476, -490, -484, -482, -479, -464, -446, -456, -482, -486, -490, -483, -477, -482, -475, -456, -488, -486, -482, -493, -490, -480, -476, -460}, {-815, -833, -844, -867, -866, -863, -814, -852, -810, -826, -845, -871, -865, -892, -839, -820, -796, -838, -845, -891, -894, -871, -853, -827, -801, -825, -852, -859, -906, -913, -854, -834, -831, -814, -851, -868, -871, -834, -825, -809, -820, -818, -826, -840, -834, -832, -818, -800, -822, -824, -818, -832, -845, -818, -809, -814, -823, -805, -822, -808, -811, -808, -778, -759}, {30, 44, -18, 19, -1, 8, -1, -22, 28, 11, -6, -13, -10, -41, -25, -3, 36, -7, 0, -12, -17, -37, -31, -3, 51, 16, -12, -15, -25, -27, -18, 4, 40, 7, -7, -20, -26, -27, -13, 10, 26, 5, -18, -27, -29, -32, -16, 4, 19, 5, -13, -16, -22, -27, -21, 0, -3, 7, 16, 7, 4, 2, 11, 32}}};


const int Mirror64[64] = {
        56, 57, 58, 59, 60, 61, 62, 63,
        48, 49, 50, 51, 52, 53, 54, 55,
        40, 41, 42, 43, 44, 45, 46, 47,
        32, 33, 34, 35, 36, 37, 38, 39,
        24, 25, 26, 27, 28, 29, 30, 31,
        16, 17, 18, 19, 20, 21, 22, 23,
        8, 9, 10, 11, 12, 13, 14, 15,
        0, 1, 2, 3, 4, 5, 6, 7
};

// clang-format on

#define MIRROR64(sq) (Mirror64[(sq)])

int PieceSquareSimple(S_BOARD *pos) {
    int sq = OFFBOARD;
    int black_offset = 6; // by how many indices move pieces
    int pce_white;
    int pce_black;

    int score = pos->material[WHITE] - pos->material[BLACK];
    for (pce_white = wP; pce_white <= wK; pce_white++) {
        for (int pce_num = 0; pce_num < pos->pceNum[pce_white]; pce_num++) {
            sq = pos->pList[pce_white][pce_num];
            assert(SqOnBoard(sq));
            score += WhitePieceSquareEvals[pce_white][SQ64(sq)];
        }

        pce_black = pce_white + black_offset;
        for (int pce_num = 0; pce_num < pos->pceNum[pce_black]; pce_num++) {
            sq = pos->pList[pce_black][pce_num];
            assert(SqOnBoard(sq));
            score -= WhitePieceSquareEvals[pce_white][MIRROR64(SQ64(sq))];
        }
    }

    if (pos->side == WHITE) {
        return score;
    } else {
        return -score;
    }
}

int EvalPieceOnSquare(int piece, int square) {
    assert(PieceValid(piece));
    int col = PieceCol[piece];
    if (col == WHITE) {
        return WhitePieceSquareEvals[piece][SQ64(square)];
    } else {
        return WhitePieceSquareEvals[piece - 6][MIRROR64(SQ64(square))];
    }
}

static int GamePhase(S_BOARD *pos) {
    int allPieces = 0;
    for (int i = 0; i < 13; i++)
        allPieces += pos->pceNum[i];
    if (allPieces >= 25) {
        return 0;
    } else if (allPieces >= 15) {
        return 1;
    } else {
        return 2;
    }
}

int PieceSquare(S_BOARD *pos) {
    int sq = OFFBOARD;
    int pce;
    int score = 0; // pos->material[WHITE] - pos->material[BLACK];
    for (pce = wP; pce <= bK; pce++) {
        for (int pce_num = 0; pce_num < pos->pceNum[pce]; pce_num++) {
            sq = pos->pList[pce][pce_num];
            assert(SqOnBoard(sq));
            if (pce == wK || pce == bK) {

            } else {
                score += PieceSquareEvals[pce][SQ64(sq)];
            }
        }
    }

    if (pos->side == WHITE) {
        return score;
    } else {
        return -score;
    }
}

static int PieceSquarePhase(S_BOARD *pos) {
    int sq = OFFBOARD;
    int pce;
    int score = 0; // pos->material[WHITE] - pos->material[BLACK];
    int phase = GamePhase(pos);
    for (pce = wP; pce <= bK; pce++) {
        for (int pce_num = 0; pce_num < pos->pceNum[pce]; pce_num++) {
            sq = pos->pList[pce][pce_num];
            assert(SqOnBoard(sq));
            assert(((pce - 1) * 8 * 8 * 3 + SQ64(sq) * 3 + phase) < 2304);
            if (pce == wK || pce == bK) {
                score += 0;
            } else {
                score += PieceSquarePhaseEvals[phase][pce - 1][SQ64(sq)];
            }
        }
    }

    if (pos->side == WHITE) {
        return score;
    } else {
        return -score;
    }
}

int IsThreefold(S_BOARD *board) {
    if (board->hisPly < 8) {
        return 0;
    }

    int repeats = 0;

    for (int i = 0; i <= board->ply; i++) {
        assert(board->ply - i >= 0);
        if (board->history[board->ply - i].posKey == board->posKey) {
            repeats++;
            if (repeats >= 3) {
                return 1;
            }
        }
    }
    return 0;
}

int EvalPosition(S_BOARD *pos) {
//    NNEvalPositionInc(pos);
    if (pos->side == WHITE) {
        return NNEvalPositionWhite(pos);
    } else {
        return NNEvalPositionBlack(pos);
    }
}
